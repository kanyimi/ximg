{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% block robots_meta %}
  <meta name="robots" content="index, follow">
{% endblock %}

{% block content %}
<div class="container-fluid" xmlns="http://www.w3.org/1999/html">
    <!-- Upload Form Card -->
    <div class="card" style="max-width:100%;">
        <h3 class="mb-3 text-center">
            {% translate "file Hosting with automatic" %}
            <b style="color:#227851;">{% translate "EXIF (metadata) cleaning" %}</b>
        </h3>
        <!-- Upload Status Container -->
        <div id="uploadStatusContainer" style="display: none;">
            <div class="alert alert-info" role="alert">
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-2" role="status">
                        <span class="visually-hidden">{% translate "Loading..." %}</span>
                    </div>
                    <strong id="uploadStatusText">{% translate "Uploading files..." %}</strong>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="mb-3">
                <div class="progress" style="height: 25px;">
                    <div id="uploadProgressBar"
                         class="progress-bar progress-bar-striped progress-bar-animated"
                         role="progressbar"
                         style="width: 0%;"
                         aria-valuenow="0"
                         aria-valuemin="0"
                         aria-valuemax="100">
                        0%
                    </div>
                </div>
                <div class="d-flex justify-content-between mt-1">
                    <small id="uploadProgressText">0 {% translate "of" %} 0 {% translate "files uploaded" %}</small>
                    <small id="uploadSpeedText"></small>
                </div>
            </div>

            <!-- File List -->
            <div id="uploadFileList" class="mb-3" style="max-height: 200px; overflow-y: auto;">
                <!-- Files will be listed here -->
            </div>

            <!-- Cancel Button -->
            <div class="text-center">
                <button id="cancelUploadBtn" type="button" class="btn btn-danger">
                    <i class="fas fa-times-circle me-1"></i> {% translate "Cancel Upload" %}
                </button>
            </div>
        </div>

        <form id="uploadForm" method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- File Upload -->
            <fieldset class="mb-4">

                <div class="quick-upload" id="dropZone">
                    <i class="fa-solid fa-cloud-upload-alt fa-3x mb-3" style="color:#227851;"></i>
                    <br>
                    <!-- Hidden file input -->
                    <input type="file" id="fileInput" name="files" multiple required style="display: none;">

                    <!-- Click button -->
                    <label for="fileInput" class="btn-select-files">
                        <i class="fa-solid fa-folder-open"></i>{% translate " Select files to upload" %}
                    </label>
                    <br><br>
                    <!-- File counter -->
                    <div id="fileCount" style="margin-top:10px; font-size:16px; color:#555;"></div>
                    <p class="text-muted mt-3">{% translate "Or Drag and Drop" %}</p>
                </div>
                <!-- File warnings -->
                <div id="fileWarnings" style="margin-top:10px; color:#dc3545; font-size:14px;"></div>

                <!-- Previews -->
                <div id="previewContainer" style="
                    display:grid;
                    grid-template-columns: repeat(auto-fill, minmax(120px,1fr));
                    gap:10px;
                    margin-top:15px;
                "></div>
            </fieldset>

            <!-- Section Details -->
            <fieldset class="mb-4">
                <div class="row g-3">
                    <!-- Keep filenames -->
                    <div class="col-md-12 d-flex align-items-center mt-4">
                        <div class="form-check">
                            {{ sform.keep_original_filenames }}
                            <label class="form-check-label" for="{{ sform.keep_original_filenames.label }}">
                                    {% translate "Keep original filenames" %}
                                <span class="info-tooltip">
                                    <img src="{% static 'source/Info.svg' %}" alt="info" style="height:20px;">
                                    <span class="tooltip-text">
                                        {% translate "The function allows you to" %} <b style="color:#227851;">{% translate "save the original file names" %} </b>{% translate "after uploading to the hosting" %}.
                                    </span>
                                </span>
                            </label>
                        </div>
                    </div>

                    <!-- Expiration -->
                    <div class="col-md-8 ms-4">
                        <div class="d-flex align-items-center gap-4">
                            <label class="form-label fw-semibold mb-0" style="white-space:nowrap;">
                                {% translate "Deletion time" %}:
                            </label>
                            {{ sform.lifetime_days }}
                        </div>
                        <div class="form-text mt-1">
                            {% translate "Data stored from 1 to 60 days" %}
                        </div>
                    </div>
                </div>
            </fieldset>

            <div class="text-center">
                <button id="submitBtn" type="submit" class="btn btn-primary">
                    <i class="fa fa-cloud-upload" style="font-size:24px;max-width:100%;"></i> {% translate "Upload" %}
                </button>
            </div>

            <h6 class="text-center" style="color:#999999; padding:15px;">
               {% translate " We delete ExIf (meta tags) from media files (JPG, PDF, PSD and other)" %}.
                <a href="#" id="openSupportedFiles" style="color:#227851; cursor:pointer;">
                   {% translate "Supported files" %}
                </a>
            </h6>
        </form>
    </div>
</div>
{% include "includes/supported_files_modal.html" %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('supportedFilesModal');
    const openBtn = document.getElementById('openSupportedFiles');
    const closeBtn = modal.querySelector('.modal-close');

    openBtn.addEventListener('click', (e) => {
        e.preventDefault();
        modal.classList.add('show');
    });

    closeBtn.addEventListener('click', () => {
        modal.classList.remove('show');
    });

    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.remove('show');
        }
    });
});
</script>
{% endblock %}

{% block extra_css %}
<style>
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.modal-overlay.show {
    display: flex;
}

.modal-content {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    max-width: 500px;
    width: 90%;
    position: relative;
    animation: fadeIn 0.2s ease-out;
}

.modal-close {
    position: absolute;
    top: 10px;
    right: 12px;
    border: none;
    background: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
}

.file-types {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
}

.file-type-badge {
    background: #227851;
    color: #fff;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 12px;
}

/* Upload file list item */
.upload-file-item {
    padding: 8px 12px;
    border-bottom: 1px solid #eee;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.upload-file-item:last-child {
    border-bottom: none;
}

.file-status {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    margin-right: 10px;
}

.file-status.uploading {
    background-color: #007bff;
    animation: pulse 1.5s infinite;
}

.file-status.completed {
    background-color: #28a745;
}

.file-status.failed {
    background-color: #dc3545;
}

.file-status.pending {
    background-color: #6c757d;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}
</style>
{% endblock %}